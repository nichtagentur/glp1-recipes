---
interface Props {
  title: string;
  description: string;
  image: string;
  pubDate: string;
  prepTime: string;
  cookTime: string;
  totalTime: string;
  servings: number;
  calories: number;
  protein: number;
  carbs: number;
  fat: number;
  fiber: number;
  ingredients: string[];
  instructions: string[];
  category: string;
  slug: string;
}

const props = Astro.props;
const base = import.meta.env.BASE_URL;
const site = Astro.site?.toString().replace(/\/$/, '') || '';

const recipeSchema = {
  "@context": "https://schema.org",
  "@type": "Recipe",
  name: props.title,
  description: props.description,
  image: `${site}${base}/${props.image}`,
  author: {
    "@type": "Organization",
    name: "GLP-1 Recipes"
  },
  datePublished: props.pubDate,
  prepTime: `PT${props.prepTime.replace(/\s/g, '').toUpperCase()}`,
  cookTime: `PT${props.cookTime.replace(/\s/g, '').toUpperCase()}`,
  totalTime: `PT${props.totalTime.replace(/\s/g, '').toUpperCase()}`,
  recipeYield: `${props.servings} servings`,
  recipeCategory: props.category,
  nutrition: {
    "@type": "NutritionInformation",
    calories: `${props.calories} calories`,
    proteinContent: `${props.protein}g`,
    carbohydrateContent: `${props.carbs}g`,
    fatContent: `${props.fat}g`,
    fiberContent: `${props.fiber}g`
  },
  recipeIngredient: props.ingredients,
  recipeInstructions: props.instructions.map((step, i) => ({
    "@type": "HowToStep",
    position: i + 1,
    text: step
  }))
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: `${site}${base}`
    },
    {
      "@type": "ListItem",
      position: 2,
      name: props.category.replace('-', ' '),
      item: `${site}${base}category/${props.category}/`
    },
    {
      "@type": "ListItem",
      position: 3,
      name: props.title,
      item: `${site}${base}recipes/${props.slug}/`
    }
  ]
};
---

<script type="application/ld+json" set:html={JSON.stringify(recipeSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
