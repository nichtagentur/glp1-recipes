---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEOHead from '../components/SEOHead.astro';
import NutritionBadge from '../components/NutritionBadge.astro';
import RecipeSchema from '../components/RecipeSchema.astro';

const { frontmatter, slug } = Astro.props;
const base = import.meta.env.BASE_URL;
const {
  title, description, image, imageAlt, pubDate, category,
  prepTime, cookTime, totalTime, servings,
  calories, protein, carbs, fat, fiber,
  ingredients, instructions, tags
} = frontmatter;

const nutritionItems = [
  { value: calories, unit: '', label: 'Calories' },
  { value: protein, unit: 'g', label: 'Protein' },
  { value: carbs, unit: 'g', label: 'Carbs' },
  { value: fat, unit: 'g', label: 'Fat' },
  { value: fiber, unit: 'g', label: 'Fiber' },
];

const timeItems = [
  { label: 'Prep', value: prepTime },
  { label: 'Cook', value: cookTime },
  { label: 'Total', value: totalTime },
  { label: 'Serves', value: servings },
];
---

<!doctype html>
<html lang="en">
<head>
  <SEOHead title={title} description={description} image={image} type="article" />
  <RecipeSchema
    title={title} description={description} image={image}
    pubDate={pubDate} prepTime={prepTime} cookTime={cookTime}
    totalTime={totalTime} servings={servings}
    calories={calories} protein={protein} carbs={carbs}
    fat={fat} fiber={fiber}
    ingredients={ingredients} instructions={instructions}
    category={category} slug={slug}
  />
</head>
<body class="min-h-screen flex flex-col">
  <Header />
  <main class="flex-1">

    <!-- Cinematic Hero -->
    <div class="relative w-full h-[55vh] md:h-[70vh] overflow-hidden">
      <img
        src={`${base}/${image}`}
        alt={imageAlt}
        class="w-full h-full object-cover animate-scale-in"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-midnight via-midnight/40 to-transparent" />
      <div class="absolute inset-0 bg-gradient-to-r from-midnight/30 to-transparent" />

      <!-- Title overlay -->
      <div class="absolute bottom-0 left-0 right-0 px-6 pb-12 md:pb-16 max-w-4xl mx-auto">
        <nav class="text-[11px] text-cream-muted/60 tracking-widest uppercase mb-4 animate-fade-up delay-1">
          <a href={base} class="hover:text-amber transition-colors">Home</a>
          <span class="mx-2">/</span>
          <a href={`${base}/category/${category}/`} class="hover:text-amber capitalize transition-colors">{category.replace('-', ' ')}</a>
        </nav>
        <h1 class="font-display text-4xl md:text-6xl font-bold text-cream leading-[1.1] mb-5 animate-fade-up delay-2">
          {title}
        </h1>
        <p class="text-cream-muted text-lg font-light max-w-2xl animate-fade-up delay-3">{description}</p>
      </div>
    </div>

    <!-- Recipe Content -->
    <article class="max-w-4xl mx-auto px-6 py-12">

      <!-- Time + Nutrition bar -->
      <div class="flex flex-wrap items-center gap-6 pb-8 mb-10 border-b border-cream/[0.08] animate-fade-up delay-4">
        {timeItems.map(item => (
          <div class="text-center">
            <div class="text-[10px] text-cream-muted/50 tracking-[0.15em] uppercase mb-1">{item.label}</div>
            <div class="text-sm text-cream font-medium">{item.value}</div>
          </div>
        ))}
        <div class="flex-1" />
        <NutritionBadge calories={calories} protein={protein} />
      </div>

      <!-- Nutrition grid -->
      <div class="grid grid-cols-5 gap-4 mb-14 animate-fade-up delay-5">
        {nutritionItems.map((item, i) => (
          <div class="text-center py-6 border border-cream/[0.06] rounded-sm bg-charcoal/50">
            <div class={`font-display text-3xl font-bold ${i === 1 ? 'text-amber' : 'text-cream'}`}>
              {item.value}<span class="text-lg">{item.unit}</span>
            </div>
            <div class="text-[10px] text-cream-muted/50 tracking-[0.15em] uppercase mt-1">{item.label}</div>
          </div>
        ))}
      </div>

      <!-- Two-column layout: Ingredients + Instructions -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 mb-14">

        <!-- Ingredients -->
        <div class="lg:col-span-4 animate-fade-up delay-5">
          <h2 class="font-display text-2xl font-bold text-cream mb-6 flex items-center gap-3">
            Ingredients
            <span class="flex-1 h-px bg-cream/[0.08]"></span>
          </h2>
          <ul class="space-y-3">
            {ingredients.map((item: string) => (
              <li class="flex items-start gap-3 text-cream/80 font-light text-[15px] leading-relaxed">
                <span class="w-1.5 h-1.5 mt-2 rounded-full bg-amber shrink-0"></span>
                <span>{item}</span>
              </li>
            ))}
          </ul>
        </div>

        <!-- Instructions -->
        <div class="lg:col-span-8 animate-fade-up delay-6">
          <h2 class="font-display text-2xl font-bold text-cream mb-6 flex items-center gap-3">
            Instructions
            <span class="flex-1 h-px bg-cream/[0.08]"></span>
          </h2>
          <ol class="space-y-6">
            {instructions.map((step: string, i: number) => (
              <li class="flex gap-5 group">
                <div class="shrink-0 w-10 h-10 rounded-full border border-amber/30 text-amber flex items-center justify-center text-sm font-display font-bold group-hover:bg-amber group-hover:text-midnight transition-all duration-300">
                  {i + 1}
                </div>
                <p class="text-cream/80 font-light text-[15px] leading-relaxed pt-2">{step}</p>
              </li>
            ))}
          </ol>
        </div>
      </div>

      <!-- Tags -->
      {tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-10 pt-8 border-t border-cream/[0.06]">
          {tags.map((tag: string) => (
            <span class="text-[11px] text-cream-muted/50 tracking-wider uppercase border border-cream/[0.06] px-3 py-1 hover:border-amber/30 hover:text-amber transition-all duration-300 cursor-default">
              #{tag}
            </span>
          ))}
        </div>
      )}

      <!-- Published date -->
      <p class="text-[11px] text-cream-muted/30 tracking-widest uppercase">
        Published {new Date(pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
      </p>
    </article>
  </main>
  <Footer />
</body>
</html>
